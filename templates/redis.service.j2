# {{ ansible_managed }}
[Unit]
Description=Redis persistent key-value database
After=network.target
After=network-online.target
Wants=network-online.target

[Service]
ExecStartPre=-/usr/bin/echo 'never' > /sys/kernel/mm/transparent_hugepage/enabled
ExecStartPre=-/usr/bin/echo 'never' > /sys/kernel/mm/transparent_hugepage/defrag
ExecStartPre=-/usr/bin/echo '512' > /proc/sys/net/core/somaxconn
ExecStart=/usr/local/bin/redis-server /etc/redis/{{ redis_port }}.conf --supervised systemd
ExecStop=/usr/local/libexec/redis-shutdown redis/{{ redis_port }}
Type=notify
User=redis
Group=redis
RuntimeDirectory=redis
RuntimeDirectoryMode=0755

[Install]
WantedBy=multi-user.target